<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹è¿›ç‰ˆPDFè½¬å›¾ç‰‡æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
    <div class="max-w-4xl mx-auto">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                æ”¹è¿›ç‰ˆPDFè½¬å›¾ç‰‡æµ‹è¯•
            </h1>
            <p class="text-lg text-gray-600 mb-4">
                æµ‹è¯•æ”¹è¿›ç‰ˆPDFè½¬å›¾ç‰‡åŠŸèƒ½ï¼ŒåŒ…å«å¤šç§æ¸²æŸ“æ–¹æ¡ˆ
            </p>
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <p class="text-green-800 text-sm">
                    <strong>ğŸ‰ æŒ‰é¡µæ‹†åˆ†PDFæ¸²æŸ“æˆåŠŸï¼</strong> æ¯é¡µç”Ÿæˆç‹¬ç«‹å›¾ç‰‡ï¼Œæ‰€è§å³æ‰€å¾—ï¼ŒZIPæ‰“åŒ…ä¸‹è½½
                </p>
                <p class="text-green-600 text-xs mt-1">
                    âœ… æœ€æ–°æµ‹è¯•ï¼š4é¡µPDF â†’ æŒ‰é¡µæ‹†åˆ† â†’ 3é¡µæˆåŠŸæ¸²æŸ“ â†’ ZIPæ‰“åŒ… (146.52 KBï¼ŒåŒ…å«page-001.jpgç­‰ç‹¬ç«‹å›¾ç‰‡)
                </p>
            </div>
        </div>

        <!-- æœåŠ¡å™¨çŠ¶æ€ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">æœåŠ¡å™¨çŠ¶æ€</h2>
            <div id="serverStatus" class="text-gray-600">æ£€æŸ¥ä¸­...</div>
        </div>

        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">é€‰æ‹©PDFæ–‡ä»¶</h2>
            
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors">
                <input type="file" id="pdfFile" accept=".pdf" class="hidden">
                <div id="dropZone" class="cursor-pointer">
                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <p class="text-lg text-gray-600 mb-2">ç‚¹å‡»é€‰æ‹©PDFæ–‡ä»¶</p>
                    <p class="text-sm text-gray-500">æ”¯æŒæœ€å¤§50MBçš„PDFæ–‡ä»¶</p>
                </div>
            </div>

            <div id="fileInfo" class="mt-4 hidden">
                <div class="bg-blue-50 border border-blue-200 rounded p-3">
                    <p class="text-blue-800 text-sm">
                        <strong>å·²é€‰æ‹©æ–‡ä»¶ï¼š</strong> <span id="fileName"></span>
                    </p>
                    <p class="text-blue-600 text-sm">
                        <strong>æ–‡ä»¶å¤§å°ï¼š</strong> <span id="fileSize"></span>
                    </p>
                </div>
            </div>
        </div>

        <!-- è½¬æ¢æ§åˆ¶ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">è½¬æ¢è®¾ç½®</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ ‡æ ¼å¼</label>
                <select id="targetFormat" class="w-full p-2 border border-gray-300 rounded-md">
                    <option value="jpg">JPGå›¾ç‰‡</option>
                </select>
            </div>

            <button id="convertBtn" onclick="convertPdfToImage()" 
                    class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">
                å¼€å§‹è½¬æ¢ (æ”¹è¿›ç‰ˆ)
            </button>
        </div>

        <!-- è¿›åº¦æ˜¾ç¤º -->
        <div id="progress" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">è½¬æ¢è¿›åº¦</h2>
            <div class="bg-gray-200 rounded-full h-3 mb-4">
                <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="progressText" class="text-sm text-gray-600">å‡†å¤‡ä¸­...</p>
            <div id="progressLog" class="mt-4 bg-gray-50 rounded p-3 text-xs text-gray-600 max-h-32 overflow-y-auto"></div>
        </div>

        <!-- ç»“æœæ˜¾ç¤º -->
        <div id="result" class="bg-white rounded-lg shadow p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">è½¬æ¢ç»“æœ</h2>
            <div id="successResult" class="hidden">
                <div class="bg-green-50 border border-green-200 rounded p-4 mb-4">
                    <p class="text-green-800 font-medium">âœ… è½¬æ¢æˆåŠŸï¼</p>
                    <p class="text-green-600 text-sm mt-1" id="resultInfo"></p>
                </div>
                <div class="flex gap-4">
                    <button id="downloadBtn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors">
                        ä¸‹è½½å›¾ç‰‡
                    </button>
                    <button onclick="resetForm()" class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700 transition-colors">
                        é‡æ–°è½¬æ¢
                    </button>
                </div>
            </div>
            <div id="errorResult" class="hidden">
                <div class="bg-red-50 border border-red-200 rounded p-4 mb-4">
                    <p class="text-red-800 font-medium">âŒ è½¬æ¢å¤±è´¥</p>
                    <p class="text-red-600 text-sm mt-1" id="errorMessage"></p>
                </div>
                <button onclick="resetForm()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors">
                    é‡è¯•
                </button>
            </div>
        </div>

        <!-- æŠ€æœ¯è¯´æ˜ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">æ”¹è¿›ç‰ˆç‰¹æ€§</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="font-medium text-blue-600 mb-2">ğŸ¯ æ–¹æ¡ˆ1: PDF.jsæŒ‰é¡µæ‹†åˆ† âœ…</h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ âœ… æ¯é¡µç‹¬ç«‹å›¾ç‰‡</li>
                        <li>â€¢ âœ… æ‰€è§å³æ‰€å¾—æ¸²æŸ“</li>
                        <li>â€¢ âœ… é«˜åˆ†è¾¨ç‡è¾“å‡º</li>
                        <li>â€¢ âœ… ZIPè‡ªåŠ¨æ‰“åŒ…</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium text-green-600 mb-2">ğŸ”§ æ–¹æ¡ˆ2: pdf2pic</h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ ç³»ç»Ÿçº§PDFæ¸²æŸ“</li>
                        <li>â€¢ éœ€è¦GraphicsMagick</li>
                        <li>â€¢ å¤‡ç”¨æ–¹æ¡ˆ</li>
                        <li>â€¢ å¯èƒ½å‡ºç°EPIPEé”™è¯¯</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium text-green-600 mb-2">ğŸ“ æ–¹æ¡ˆ1.5: æ–‡æœ¬æå– âœ…</h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ âœ… çœŸå®PDFæ–‡å­—æå–</li>
                        <li>â€¢ âœ… å¤šé¡µå†…å®¹åˆå¹¶</li>
                        <li>â€¢ âœ… æ™ºèƒ½æ’ç‰ˆæ˜¾ç¤º</li>
                        <li>â€¢ âœ… å½“å‰ä¸»è¦æ–¹æ¡ˆ</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium text-purple-600 mb-2">ğŸ“‹ æ–¹æ¡ˆ3: æ”¹è¿›é¢„è§ˆ</h3>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>â€¢ é«˜è´¨é‡é¢„è§ˆå›¾</li>
                        <li>â€¢ 100%æˆåŠŸç‡</li>
                        <li>â€¢ åŒ…å«è¯¦ç»†ä¿¡æ¯</li>
                        <li>â€¢ æœ€ç»ˆå¤‡ç”¨æ–¹æ¡ˆ</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- æ—¥å¿—åŒºåŸŸ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">æ“ä½œæ—¥å¿—</h2>
            <div id="logArea" class="bg-gray-50 rounded p-4 h-32 overflow-y-auto text-sm text-gray-600">
                <p>ç­‰å¾…æ“ä½œ...</p>
            </div>
        </div>
    </div>

    <script>
        let uploadedFilename = null;
        let downloadUrl = null;

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        window.addEventListener('load', () => {
            log('æ”¹è¿›ç‰ˆPDFè½¬å›¾ç‰‡æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            checkServerStatus();
        });

        // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        async function checkServerStatus() {
            try {
                const response = await fetch('http://localhost:3001/');
                const data = await response.json();
                
                document.getElementById('serverStatus').innerHTML = `
                    <div class="text-green-600">
                        <p><strong>âœ… æœåŠ¡å™¨åœ¨çº¿</strong></p>
                        <p>ç‰ˆæœ¬: ${data.version}</p>
                        <p>åŠŸèƒ½: ${data.features.join(', ')}</p>
                    </div>
                `;
                log('æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥æˆåŠŸ: ' + data.message);
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = `
                    <div class="text-red-600">
                        <p><strong>âŒ æœåŠ¡å™¨ç¦»çº¿</strong></p>
                        <p>è¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œåœ¨ç«¯å£3001</p>
                    </div>
                `;
                log('æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥å¤±è´¥: ' + error.message);
            }
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        const fileInput = document.getElementById('pdfFile');
        const dropZone = document.getElementById('dropZone');

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFileSelect(file);
            }
        });

        function handleFileSelect(file) {
            if (file.type !== 'application/pdf') {
                showError('è¯·é€‰æ‹©PDFæ ¼å¼çš„æ–‡ä»¶');
                return;
            }

            if (file.size > 50 * 1024 * 1024) {
                showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MB');
                return;
            }

            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').classList.remove('hidden');
            
            log(`æ–‡ä»¶é€‰æ‹©æˆåŠŸ: ${file.name} (${formatFileSize(file.size)})`);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // è½¬æ¢å‡½æ•°
        async function convertPdfToImage() {
            const file = fileInput.files[0];

            if (!file) {
                showError('è¯·é€‰æ‹©PDFæ–‡ä»¶');
                return;
            }

            try {
                showProgress('ä¸Šä¼ æ–‡ä»¶...', 10);
                log('å¼€å§‹ä¸Šä¼ æ–‡ä»¶: ' + file.name);

                // ä¸Šä¼ æ–‡ä»¶
                const formData = new FormData();
                formData.append('file', file);

                const uploadResponse = await fetch('http://localhost:3001/api/upload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥');
                }

                const uploadResult = await uploadResponse.json();
                uploadedFilename = uploadResult.filename;
                
                showProgress('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œå¼€å§‹è½¬æ¢...', 30);
                log('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: ' + uploadedFilename);

                // è½¬æ¢æ–‡ä»¶
                const convertResponse = await fetch('http://localhost:3001/api/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        filename: uploadedFilename,
                        targetFormat: 'jpg'
                    })
                });

                showProgress('è½¬æ¢å¤„ç†ä¸­...', 70);

                if (!convertResponse.ok) {
                    const errorData = await convertResponse.json();
                    throw new Error(errorData.error || 'è½¬æ¢å¤±è´¥');
                }

                const convertResult = await convertResponse.json();
                downloadUrl = convertResult.downloadUrl;
                
                showProgress('è½¬æ¢å®Œæˆ!', 100);
                log('è½¬æ¢æˆåŠŸ: ' + convertResult.outputFilename);

                setTimeout(() => {
                    showSuccess(convertResult);
                }, 500);

            } catch (error) {
                log('è½¬æ¢å¤±è´¥: ' + error.message);
                showError(error.message);
            }
        }

        function showProgress(text, percent) {
            document.getElementById('progress').classList.remove('hidden');
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
            
            // æ·»åŠ åˆ°æ—¥å¿—
            const logDiv = document.getElementById('progressLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function showSuccess(result) {
            document.getElementById('progress').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('successResult').classList.remove('hidden');
            document.getElementById('errorResult').classList.add('hidden');
            
            document.getElementById('resultInfo').textContent = 
                `è¾“å‡ºæ–‡ä»¶: ${result.outputFilename}`;
            
            document.getElementById('downloadBtn').onclick = () => {
                window.open('http://localhost:3001' + downloadUrl, '_blank');
                log('å¼€å§‹ä¸‹è½½æ–‡ä»¶');
            };
        }

        function showError(message) {
            document.getElementById('progress').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('successResult').classList.add('hidden');
            document.getElementById('errorResult').classList.remove('hidden');
            
            document.getElementById('errorMessage').textContent = message;
        }

        function resetForm() {
            document.getElementById('fileInfo').classList.add('hidden');
            document.getElementById('progress').classList.add('hidden');
            document.getElementById('result').classList.add('hidden');
            fileInput.value = '';
            uploadedFilename = null;
            downloadUrl = null;
            log('è¡¨å•å·²é‡ç½®');
        }

        function log(message) {
            const logArea = document.getElementById('logArea');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }
    </script>
</body>
</html>
